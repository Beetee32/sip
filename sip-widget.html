<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Simple SIP Planner — Goal-driven</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<style>
  :root{--bg:#f7fafc;--card:#fff;--accent:#0b74de;--accent2:#0a5fb2;--muted:#6b7280;--success:#16a34a;--danger:#dc2626}
  *{box-sizing:border-box}
  body{font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);margin:0;padding:20px;color:#0f172a}
  .wrap{max-width:1100px;margin:0 auto}
  .header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:12px}
  h1{font-size:20px;margin:0}
  .sub{color:var(--muted);font-size:13px}
  .card{background:var(--card);border-radius:12px;padding:18px;box-shadow:0 10px 30px rgba(0,0,0,0.06)}
  .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px}
  label{display:block;font-size:13px;color:#111;margin-bottom:6px}
  input[type=number],select{width:100%;padding:10px;border-radius:8px;border:1px solid #e6e9ef;font-size:14px}
  .controls{display:flex;gap:10px;align-items:center;margin-top:12px;flex-wrap:wrap}
  .btn{padding:10px 14px;border-radius:8px;border:none;cursor:pointer;font-weight:700}
  .btn.primary{background:var(--accent);color:#fff}
  .btn.ghost{background:transparent;border:1px solid #e6e9ef}
  .panel{background:#fbfdff;border-radius:10px;padding:12px;border:1px solid #eef3fb}
  .muted{color:var(--muted);font-size:13px}
  .result-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:12px;margin-top:14px}
  .kpi{font-size:16px;font-weight:700}
  .accent-text{color:var(--accent2);font-weight:700}
  .segmented{display:inline-flex;border-radius:10px;overflow:hidden;border:1px solid #e6e9ef}
  .segmented button{background:transparent;border:0;padding:8px 12px;cursor:pointer}
  .segmented button.active{background:var(--accent);color:#fff}
  .charts{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:12px;margin-top:12px}
  .whatsapp{position:fixed;right:18px;bottom:18px;background:#25D366;color:#fff;padding:12px 14px;border-radius:999px;display:flex;gap:10px;align-items:center;box-shadow:0 8px 20px rgba(0,0,0,0.12);text-decoration:none;font-weight:700;z-index:9999}
  .tooltip{position:relative;display:inline-block}
  .tooltip .tt{visibility:hidden;width:260px;background:#111;color:#fff;text-align:left;border-radius:6px;padding:8px;position:absolute;z-index:10;bottom:125%;left:50%;transform:translateX(-50%);font-size:12px;line-height:1.3}
  .tooltip:hover .tt{visibility:visible}
  .error{color:var(--danger);font-weight:700}
  .success{color:var(--success);font-weight:700}
  @media(max-width:600px){.header{flex-direction:column;align-items:flex-start}.controls{flex-direction:column;align-items:stretch}.charts{grid-template-columns:1fr}}
</style>
</head>
<body>
<a class="whatsapp" href="https://wa.me/917666123827" target="_blank" rel="noopener">Any doubts? Chat on WhatsApp</a>
<div class="wrap">
  <div class="header">
    <div><h1>Simple SIP Planner</h1><div class="sub">Goal-driven • Compare scenarios • Download Excel</div></div>
    <div style="display:flex;gap:8px;align-items:center">
      <button id="downloadBtn" class="btn primary">Download Excel</button>
      <button id="resetBtn" class="btn ghost">Reset</button>
    </div>
  </div>

  <div class="card">
    <div style="display:flex;gap:8px;margin-bottom:12px">
      <button id="tabPlanner" class="btn" style="font-weight:700">Planner</button>
      <button id="tabGoal" class="btn">Goal Planner</button>
    </div>

    <div id="panePlanner">
      <div class="grid">
        <div><label for="husband">Husband monthly income (₹)</label><input id="husband" type="number" value="100000"></div>
        <div><label for="wife">Wife monthly income (₹)</label><input id="wife" type="number" value="100000"></div>
        <div><label for="house">Household expenses (₹)</label><input id="house" type="number" value="60000"></div>
        <div><label for="emi">EMI (₹)</label><input id="emi" type="number" value="20000"></div>
        <div><label for="misc">Misc expenses (₹)</label><input id="misc" type="number" value="20000"></div>
      </div>

      <hr style="margin:14px 0;border:none;border-top:1px solid #eef3fb">

      <div style="display:flex;gap:12px;flex-wrap:wrap;justify-content:space-between;align-items:center">
        <div>
          <div style="margin-bottom:6px;font-weight:700">Allocation preset
            <span class="tooltip"><span class="tt">Conservative → more Large cap<br>Balanced → moderate risk<br>Aggressive → higher Mid/Small</span></span>
          </div>
          <div class="segmented">
            <button id="presetCons" class="seg-btn">Conservative</button>
            <button id="presetBal" class="seg-btn active">Balanced</button>
            <button id="presetAgg" class="seg-btn">Aggressive</button>
          </div>
        </div>
        <div style="min-width:320px">
          <label>Allocation (Large • Mid • Small %)</label>
          <div style="display:flex;gap:8px">
            <input id="lc" type="number" value="45" min="0" max="100" style="width:33.33%">
            <input id="mc" type="number" value="30" min="0" max="100" style="width:33.33%">
            <input id="sc" type="number" value="25" min="0" max="100" style="width:33.33%">
          </div>
          <div class="muted" style="margin-top:6px">Large • Mid • Small</div>
        </div>
      </div>

      <div class="controls">
        <div style="min-width:160px"><label for="years">Projection years</label>
          <select id="years"><option>5</option><option>10</option><option selected>15</option><option>20</option></select>
        </div>
        <div style="min-width:120px"><label for="lc_r">Large cap CAGR %</label><input id="lc_r" type="number" value="9"></div>
        <div style="min-width:120px"><label for="mc_r">Mid cap CAGR %</label><input id="mc_r" type="number" value="12"></div>
        <div style="min-width:120px"><label for="sc_r">Small cap CAGR %</label><input id="sc_r" type="number" value="16"></div>
        <div style="margin-left:auto;display:flex;gap:8px;align-items:center">
          <div id="allocWarning" class="muted"></div>
          <button id="calc" class="btn primary">Calculate</button>
        </div>
      </div>

      <div id="plannerResults" class="result-grid"></div>
      <div class="charts">
        <div class="panel"><canvas id="allocChart" height="220"></canvas></div>
        <div class="panel"><canvas id="fvChart" height="220"></canvas></div>
      </div>

      <div class="panel" style="margin-top:12px">
        <div style="display:flex;gap:12px;align-items:center;justify-content:space-between;flex-wrap:wrap">
          <div id="compareCards" style="display:flex;gap:12px;flex-wrap:wrap"></div>
          <div style="display:flex;gap:8px;align-items:center">
            <select id="manualCompare">
              <option value="">Compare with...</option>
              <option value="conservative">Conservative</option>
              <option value="balanced">Balanced</option>
              <option value="aggressive">Aggressive</option>
            </select>
            <button id="applyCompare" class="btn">Compare</button>
            <button id="applyComparisonToPlanner" class="btn ghost">Apply allocation</button>
          </div>
        </div>
        <div id="compareChartContainer" style="margin-top:8px"></div>
      </div>
    </div>

    <div id="paneGoal" style="display:none">
      <div style="display:flex;gap:12px;flex-wrap:wrap">
        <div style="min-width:200px"><label for="target">Target Corpus (₹)</label><input id="target" type="number" value="10000000"></div>
        <div style="min-width:120px"><label for="goalYears">Years to reach</label><input id="goalYears" type="number" value="15"></div>
        <div style="min-width:120px"><label for="goalCagr">Expected CAGR %</label><input id="goalCagr" type="number" value="12"></div>
        <div style="min-width:120px"><label for="goalInfl">Inflation % (annual)</label><input id="goalInfl" type="number" value="5"></div>
        <div style="align-self:end;display:flex;gap:8px">
          <button id="calcGoal" class="btn primary">Calculate Goal SIP</button>
          <button id="applyGoalToPlanner" class="btn ghost">Apply required SIP</button>
          <button id="useActualIncome" class="btn" style="display:none">Use actual income</button>
        </div>
      </div>
      <div id="goalResult" class="panel" style="margin-top:14px"></div>
    </div>

    <div class="panel" style="margin-top:12px">
      <h4 style="margin:6px 0">Quick tips — why invest with us</h4>
      <ul style="margin:0 0 0 18px;color:var(--muted)">
        <li>Expert fund selection with disciplined risk controls</li>
        <li>Automatic SIPs enforce discipline and reduce timing risk</li>
        <li>Diversified Large/Mid/Small exposure for growth + resilience</li>
        <li>Low-cost investing + personalized guidance</li>
      </ul>
    </div>

    <div class="panel" style="margin-top:12px">
      <div style="font-weight:700">Golden rules</div>
      <div class="muted">
        <ul style="margin:0 0 0 18px">
          <li>Save first, spend later — automate SIPs</li>
          <li>Invest with a horizon; equities reward time</li>
          <li>Keep 6–12 months expenses as emergency fund</li>
          <li>Longer goals → higher Mid/Small exposure</li>
          <li>Rebalance annually, ignore short-term noise</li>
          <li>Define goal → timeline → required SIP</li>
          <li>Save your plan — a written plan works</li>
        </ul>
      </div>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const $ = id => document.getElementById(id);

  const fmt = (n, c = false) => {
    if (isNaN(n)) return "-";
    const a = Math.abs(n);
    if (a >= 1e7) return c ? (n/1e7).toFixed(2)+" Cr" : "₹"+(n/1e7).toFixed(2)+" Cr";
    if (a >= 1e5) return c ? (n/1e5).toFixed(2)+" L" : "₹"+(n/1e5).toFixed(2)+" L";
    return c ? n.toLocaleString('en-IN') : "₹"+n.toLocaleString('en-IN');
  };

  const fvSIP = (m, r, y) => {
    if (!m) return 0;
    const i = r/100/12, n = y*12;
    if (Math.abs(i)<1e-12) return m*n;
    return m * ((Math.pow(1+i,n)-1)/i) * (1+i);
  };

  const reqSIP = (fv, cagr, y) => {
    const i = cagr/100/12, n = y*12;
    if (n<=0) return NaN;
    if (Math.abs(i)<1e-12) return fv/n;
    return fv * i / ((Math.pow(1+i,n)-1)*(1+i));
  };

  const presets = {conservative:{lc:50,mc:30,sc:20}, balanced:{lc:45,mc:30,sc:25}, aggressive:{lc:35,mc:35,sc:30}};

  const safeClick = (el, fn) => el && el.addEventListener('click', fn);

  safeClick($('#tabPlanner'), () => { $('#panePlanner').style.display=''; $('#paneGoal').style.display='none'; });
  safeClick($('#tabGoal'), () => { $('#panePlanner').style.display='none'; $('#paneGoal').style.display=''; });

  const applyPreset = name => {
    const p = presets[name];
    $('#lc').value = p.lc; $('#mc').value = p.mc; $('#sc').value = p.sc;
    document.querySelectorAll('.seg-btn').forEach(b => b.classList.remove('active'));
    $(`preset${name.charAt(0).toUpperCase()+name.slice(1)}`)?.classList.add('active');
    validateAlloc(); renderPlanner();
  };

  safeClick($('#presetCons'), () => applyPreset('conservative'));
  safeClick($('#presetBal'), () => applyPreset('balanced'));
  safeClick($('#presetAgg'), () => applyPreset('aggressive'));

  const validateAlloc = () => {
    const sum = +$('#lc').value + +$('#mc').value + +$('#sc').value;
    $('#allocWarning').innerHTML = sum===100 ? '<span class="success">100% ✓</span>' : `<span class="error">Must be 100% (now ${sum}%)</span>`;
    return sum===100;
  };
  ['lc','mc','sc'].forEach(id => $(id)?.addEventListener('input', validateAlloc));

  const getState = () => {
    const inc = +$('#husband').value + +$('#wife').value;
    const exp = +$('#house').value + +$('#emi').value + +$('#misc').value;
    const actual = Math.max(0, inc-exp);
    const investable = window._goalSIP ?? actual;
    const lc = +$('#lc').value, mc = +$('#mc').value, sc = +$('#sc').value;
    const y = +$('#years').value;
    const sip = {lc:investable*lc/100, mc:investable*mc/100, sc:investable*sc/100};
    const fv = {lc:fvSIP(sip.lc,+$('#lc_r').value,y), mc:fvSIP(sip.mc,+$('#mc_r').value,y), sc:fvSIP(sip.sc,+$('#sc_r').value,y)};
    fv.total = fv.lc + fv.mc + fv.sc;
    return {inc, exp, actual, investable, sip, fv, y};
  };

  let charts = {};
  const renderCharts = (s, cmp) => {
    if (charts.alloc) charts.alloc.destroy();
    charts.alloc = new Chart($('#allocChart'), {type:'pie', data:{labels:['Large','Mid','Small'], datasets:[{data:[+$('#lc').value,+$('#mc').value,+$('#sc').value], backgroundColor:['#0b74de','#0a5fb2','#ff7a59']}]}, options:{plugins:{legend:{position:'bottom'}}}});

    if (charts.fv) charts.fv.destroy();
    charts.fv = new Chart($('#fvChart'), {type:'bar', data:{labels:['Large','Mid','Small'], datasets:[{data:[s.fv.lc,s.fv.mc,s.fv.sc], backgroundColor:['#0b74de','#0a5fb2','#ff7a59']}]}, options:{plugins:{legend:{display:false}, tooltip:{callbacks:{label:c=>fmt(c.raw)}}}}});

    if (cmp) {
      $('#compareChartContainer').innerHTML = '<canvas id="compareChart" height="220"></canvas>';
      if (charts.cmp) charts.cmp.destroy();
      charts.cmp = new Chart($('#compareChart'), {type:'bar', data:{labels:['Large','Mid','Small'], datasets:[
        {label:'Current', data:[s.fv.lc,s.fv.mc,s.fv.sc], backgroundColor:'#0b74de'},
        {label:'Comparison', data:[cmp.fv.lc,cmp.fv.mc,cmp.fv.sc], backgroundColor:'#ff7a59'}
      ]}, options:{plugins:{legend:{position:'bottom'}}}});
    } else $('#compareChartContainer').innerHTML = '';
  };

  const renderPlanner = () => {
    if (!validateAlloc()) { $('#plannerResults').innerHTML = ''; return; }
    const s = getState();
    $('#plannerResults').innerHTML = `<div class="panel"><h3>Summary</h3>
      <div class="small">Income: <strong>${fmt(s.inc)}</strong> | Expenses: <strong>${fmt(s.exp)}</strong></div>
      <div class="small">Investable: <strong>${fmt(s.investable)}</strong> → Total SIP: <strong>${fmt(s.sip.lc+s.sip.mc+s.sip.sc)}</strong></div>
      <div class="small">Projected corpus in ${s.y} yrs: <strong>${fmt(s.fv.total)}</strong></div></div>`;

    // Auto-compare logic (kept simple)
    const cur = {lc:+$('#lc').value, mc:+$('#mc').value, sc:+$('#sc').value};
    const next = cur.lc > 47 ? 'balanced' : 'aggressive';
    const cp = presets[next];
    const cmpSIP = {lc:s.investable*cp.lc/100, mc:s.investable*cp.mc/100, sc:s.investable*cp.sc/100};
    const cmpFV = {lc:fvSIP(cmpSIP.lc,+$('#lc_r').value,s.y), mc:fvSIP(cmpSIP.mc,+$('#mc_r').value,s.y), sc:fvSIP(cmpSIP.sc,+$('#sc_r').value,s.y)};
    cmpFV.total = cmpFV.lc + cmpFV.mc + cmpFV.sc;
    const delta = cmpFV.total - s.fv.total;

    $('#compareCards').innerHTML = `
      <div class="panel"><strong>Current</strong><div>${fmt(s.fv.total)}</div></div>
      <div class="panel"><strong>${next.charAt(0).toUpperCase()+next.slice(1)}</strong><div>${fmt(cmpFV.total)}</div></div>
      <div class="panel" style="background:#fff8ec"><strong>Delta</strong><div>${delta>0?'+' : ''}${fmt(delta)}</div></div>`;
    renderCharts(s, cmpFV);
  };

  safeClick($('#calc'), renderPlanner);
  safeClick($('#applyCompare'), () => $('#manualCompare').value && applyPreset($('#manualCompare').value));
  safeClick($('#applyComparisonToPlanner'), () => $('#manualCompare').value && applyPreset($('#manualCompare').value));

  safeClick($('#calcGoal'), () => {
    const target = +$('#target').value, y = +$('#goalYears').value, cagr = +$('#goalCagr').value, infl = +$('#goalInfl').value;
    const sip = reqSIP(target, cagr, y);
    const real = target / Math.pow(1+infl/100, y);
    const state = getState();
    $('#goalResult').innerHTML = `<div class="small"><strong>Required SIP:</strong> ${fmt(sip)}</div>
      <div class="small"><strong>Today’s value:</strong> ${fmt(real)}</div>
      <div class="small"><strong>Status:</strong> ${state.actual >= sip ? '<span class="success">On track</span>' : '<span class="error">Short by '+fmt(sip-state.actual)+'</span>'}</div>`;
    window._lastGoalSIP = sip;
  });

  safeClick($('#applyGoalToPlanner'), () => {
    if (!window._lastGoalSIP) return alert('Calculate goal first');
    window._goalSIP = window._lastGoalSIP;
    $('#useActualIncome').style.display = '';
    renderPlanner();
  });

  safeClick($('#useActualIncome'), () => { window._goalSIP = null; $('#useActualIncome').style.display = 'none'; renderPlanner(); });

  safeClick($('#resetBtn'), () => {
    const def = {husband:100000,wife:100000,house:60000,emi:20000,misc:20000,lc:45,mc:30,sc:25,lc_r:9,mc_r:12,sc_r:16,years:15,target:10000000,goalYears:15,goalCagr:12,goalInfl:5};
    Object.keys(def).forEach(k => $(k) && ($(k).value = def[k]));
    window._goalSIP = null; $('#useActualIncome').style.display = 'none';
    document.querySelectorAll('.seg-btn').forEach(b => b.classList.remove('active'));
    $('#presetBal').classList.add('active');
    validateAlloc(); renderPlanner();
  });

  safeClick($('#downloadBtn'), () => {
    const s = getState();
    const ws = XLSX.utils.aoa_to_sheet([["SIP Planner Results"],["Income",s.inc],["Expenses",s.exp],["Investable",s.investable],["",""],["Projected Corpus",s.fv.total]]);
    const wb = XLSX.utils.book_new(); XLSX.utils.book_append_sheet(wb, ws, "Plan");
    XLSX.writeFile(wb, "SIP-Plan.xlsx");
  });

  validateAlloc();
  setTimeout(renderPlanner, 200);
});
</script>
</body>
</html>
