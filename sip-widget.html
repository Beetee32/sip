<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Simple SIP Planner — Your Wealth, Your Future</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
<style>
  :root{--bg:#f8fffe;--card:#ffffff;--accent:#0d9488;--accent2:#0f766e;--text:#1e293b;--muted:#64748b;--success:#16a34a;--danger:#dc2626;--shadow:0 10px 30px rgba(0,0,0,0.08);--bull:#f59e0b}
  *{box-sizing:border-box}
  body{font-family:Inter,system-ui,Arial,sans-serif;background:var(--bg);margin:0;padding:20px 16px;color:var(--text);line-height:1.6;background:linear-gradient(135deg,#f0fdfa 0%,#ccfbf1 100%)}
  .wrap{max-width:1100px;margin:0 auto}
  .header{display:flex;flex-wrap:wrap;gap:16px;justify-content:space-between;align-items:center;margin-bottom:24px}
  h1{font-size:28px;margin:0;font-weight:900;color:var(--accent2)}
  .sub{color:var(--muted);font-size:15px}
  .card{background:var(--card);border-radius:20px;padding:28px;box-shadow:var(--shadow);border:1px solid #ccfbf1}
  .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:20px}
  label{display:block;font-size:14px;font-weight:600;margin-bottom:8px;color:var(--text)}
  input[type=number],select{width:100%;padding:14px;border-radius:12px;border:1px solid #94a3b8;font-size:16px;transition:border .2s}
  input:focus{border-color:var(--accent);outline:none}
  .btn{padding:14px 28px;border-radius:12px;border:none;cursor:pointer;font-weight:700;font-size:16px;transition:all .3s;box-shadow:0 4px 12px rgba(0,0,0,0.1)}
  .btn.primary{background:var(--accent);color:#fff}
  .btn.primary:hover{background:var(--accent2);transform:translateY(-2px)}
  .btn.ghost{background:transparent;border:2px solid #94a3b8;color:var(--text)}
  .panel{background:#f0fdfa;border-radius:16px;padding:24px;border:1px solid #ccfbf1;margin-top:24px;position:relative;overflow:hidden}
  .panel::before{content:"";position:absolute;top:0;left:0;width:6px;height:100%;background:var(--accent)}
  .kpi{font-size:32px;font-weight:900;color:var(--accent2)}
  .big{font-size:44px;font-weight:900;color:var(--accent)}
  .muted{color:var(--muted);font-size:14px}
  .segmented{display:inline-flex;border-radius:14px;overflow:hidden;border:1px solid #94a3b8;box-shadow:0 4px 12px rgba(0,0,0,0.1)}
  .segmented button{background:#fff;padding:12px 20px;cursor:pointer;font-weight:700;transition:all .3s;font-size:15px;color:var(--text)}
  .segmented button.active{background:var(--accent);color:#fff}
  .radio-group{display:flex;gap:24px;margin:16px 0;flex-wrap:wrap}
  .radio-group label{display:flex;align-items:center;gap:10px;cursor:pointer;font-weight:600}
  .whatsapp{position:fixed;right:20px;bottom:20px;background:#25D366;color:#fff;padding:18px 24px;border-radius:60px;display:flex;gap:12px;align-items:center;box-shadow:0 12px 30px rgba(37,211,102,0.4);text-decoration:none;font-weight:700;z-index:999;font-size:17px;animation:pulse 2s infinite}
  @keyframes pulse{0%{box-shadow:0 12px 30px rgba(37,211,102,0.4)}50%{box-shadow:0 12px 40px rgba(37,211,102,0.6)}100%{box-shadow:0 12px 30px rgba(37,211,102,0.4)}}
  .summary-bar{background:#0f766e;color:#fff;padding:20px;border-radius:16px;margin:24px 0;display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:20px;text-align:center;box-shadow:var(--shadow)}
  .summary-bar .muted{color:#e0f2fe}
  .summary-bar .kpi{font-size:28px;color:#fff}
  .highlight{background:#fffbeb;border:1px solid #fde68a;padding:20px;border-radius:16px;margin:20px 0;text-align:center}
  .goal-banner{background:#fef3c7;border:1px solid #f59e0b;padding:16px;border-radius:12px;margin:20px 0;font-weight:600}
  .slider-container{margin:24px 0;background:#f8fffe;padding:20px;border-radius:16px;border:1px solid #ccfbf1}
  input[type=range]{width:100%;height:10px;border-radius:5px;background:#ddd;outline:none}
  input[type=range]::-webkit-slider-thumb{background:var(--accent);width:28px;height:28px;border-radius:50%;cursor:pointer}
  .chart-panel{background:#fff;border-radius:16px;padding:24px;box-shadow:var(--shadow);margin-top:24px}
  .age-insight{background:#f0fdf4;padding:24px;border-radius:16px;margin:20px 0;border:1px solid #86efac;font-size:18px}
  .risk-note{background:#fefce8;padding:20px;border-radius:16px;margin:20px 0;border-left:6px solid #f59e0b}
  .warning-box{background:#fef2f2;border:1px solid #fca5a5;padding:16px;border-radius:12px;color:#991b1b}
  .fd-comparison{background:#fef2f2;padding:20px;border-radius:16px;margin:20px 0;border-left:6px solid #dc2626}
  .disclaimer{background:#f0fdfa;padding:16px;border-radius:12px;margin:20px 0;border:1px solid #99f6e4;font-size:14px;text-align:center}
  .option-card{padding:20px;border-radius:16px;margin:12px 0;position:relative;overflow:hidden;cursor:pointer;transition:0.3s;min-height:140px}
  .option-card:hover{transform:translateY(-4px);box-shadow:0 10px 30px rgba(0,0,0,0.15)}
  .option-card.safe{background:#ecfdf5;border:2px solid #86efac}
  .option-card.balanced{background:#f0fdfa;border:3px solid #0d9488}
  .option-card.accelerated{background:#f0fdf4;border:2px solid #16a34a;box-shadow:0 8px 25px rgba(22,163,74,0.2)}
  .option-card.dream{background:#fffbeb;border:3px solid #f59e0b}
  .star{position:absolute;top:12px;right:12px;font-size:20px}
  .alloc-group{margin-top:24px}
  .alloc-row{display:flex;gap:16px;align-items:end;flex-wrap:wrap}
  .alloc-col{flex:1;min-width:140px}
  .alloc-col label{font-size:13px;margin-bottom:4px}
  .toggle-switch{position:relative;display:inline-block;width:60px;height:34px}
  .toggle-switch input{opacity:0;width:0;height:0}
  .toggle-slider{position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background:#ccc;transition:.4s;border-radius:34px}
  .toggle-slider:before{position:absolute;content:"";height:26px;width:26px;left:4px;bottom:4px;background:white;transition:.4s;border-radius:50%}
  input:checked + .toggle-slider{background:var(--accent)}
  input:checked + .toggle-slider:before{transform:translateX(26px)}
</style>
</head>
<body>
<a class="whatsapp" href="https://wa.me/917666123827?text=Hi!%20I%20just%20used%20your%20SIP%20Planner.%20I%20can%20invest%20around%20₹50,000/month.%20Please%20help%20me%20start." target="_blank" rel="noopener">
  Talk on WhatsApp
</a>
<div class="wrap">
  <div class="header">
    <div>
      <h1>Simple SIP Planner</h1>
      <div class="sub">Your path to financial freedom starts here</div>
    </div>
    <div style="display:flex;gap:12px;flex-wrap:wrap;align-items:center">
      <button id="downloadBtn" class="btn primary">Download Your Plan (Excel)</button>
      <div class="muted" style="font-size:14px">Share with family or advisor</div>
      <button id="resetBtn" class="btn ghost">Reset</button>
    </div>
  </div>

  <div class="disclaimer">
    We use realistic conservative returns (Large 10%, Mid 14%, Small 18%) — the lower end of Indian equity history.
    In strong bull markets, returns can be +4%, +8%, +12% higher respectively.
  </div>

  <div class="card">
    <div style="display:flex;gap:12px;margin-bottom:20px">
      <button id="tabPlanner" class="btn primary" style="font-weight:700">Planner</button>
      <button id="tabGoal" class="btn ghost">Goal Planner</button>
    </div>

    <!-- Planner Tab (unchanged for brevity - same as before) -->
    <div id="panePlanner">
      <!-- ... [Previous Planner Tab Code - unchanged] ... -->
      <!-- I'll include only key parts to save space -->
      <div class="radio-group">
        <label><input type="radio" name="userType" value="single" checked> Single</label>
        <label><input type="radio" name="userType" value="couple"> Couple</label>
      </div>
      <div id="singleInputs">
        <div class="grid">
          <div><label>Your Age</label><input id="ageSingle" type="number" value="30" min="20" max="70"></div>
          <div><label>Monthly Income (₹)</label><input id="incomeSingle" type="number" value="120000"></div>
        </div>
      </div>
      <div id="coupleInputs" style="display:none">
        <div class="grid">
          <div><label>Husband Age</label><input id="ageHusband" type="number" value="30"></div>
          <div><label>Wife Age</label><input id="ageWife" type="number" value="30"></div>
          <div><label>Husband Income</label><input id="husband" type="number" value="60000"></div>
          <div><label>Wife Income</label><input id="wife" type="number" value="60000"></div>
        </div>
      </div>
      <div class="grid">
        <div><label>Household Expenses</label><input id="house" type="number" value="20000"></div>
        <div><label>EMI</label><input id="emi" type="number" value="0"></div>
        <div><label>Misc Expenses</label><input id="misc" type="number" value="0"></div>
      </div>
      <!-- ... rest of planner unchanged ... -->
      <div style="text-align:center;margin:32px 0">
        <button id="calc" class="btn primary" style="padding:16px 40px;font-size:20px">Calculate</button>
      </div>
      <div id="summaryBar" class="summary-bar" style="display:none"></div>
      <div id="moneyStory" class="panel" style="display:none"></div>
      <div id="retirementInsight" class="age-insight" style="display:none"></div>
      <div id="fdComparison" class="fd-comparison" style="display:none"></div>
      <div id="extraSIP" class="slider-container" style="display:none"></div>
      <div id="emergencyFund" class="panel" style="display:none"></div>
      <div class="panel"><h3>Compare Risk Profiles</h3><div id="compareCards"></div></div>
      <div class="chart-panel"><h3>Your Wealth Growth</h3><canvas id="growthChart"></canvas></div>
    </div>

    <!-- GOAL PLANNER TAB — NOW SUPERCHARGED -->
    <div id="paneGoal" style="display:none">
      <div class="grid">
        <div><label>Target Corpus (₹)</label><input id="target" type="number" value="100000000"></div>
        <div><label>Years to reach</label><input id="goalYears" type="number" value="18"></div>
        <div><label>Expected CAGR (%)</label><input id="goalCagr" type="number" value="14" step="0.5"></div>
      </div>
      <div style="margin-top:20px">
        <label>Your monthly household income</label>
        <input id="goalIncome" type="number" placeholder="120000" style="padding:14px;font-size:16px">
      </div>

      <div style="margin-top:24px;display:flex;gap:12px;flex-wrap:wrap">
        <button id="calcGoal" class="btn primary">Calculate Required SIP</button>
      </div>

      <div id="goalResult" class="panel" style="margin-top:20px;display:none"></div>
      <div id="goalScenarios" style="display:none;margin-top:20px">
        <h3 style="margin-bottom:20px">Smart Ways to Reach Your Goal Faster</h3>
        <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:16px">
          <div class="option-card safe" onclick="applyScenario('safe')">
            <strong>Safe & Steady</strong><br>
            Invest <span id="safeSIP">₹30,000</span>/month<br>
            Reach goal in <span id="safeYears">18</span> years
          </div>
          <div class="option-card balanced" onclick="applyScenario('balanced')">
            <strong>Recommended</strong> ★<br>
            Invest <span id="reqSIP">₹48,000</span>/month<br>
            Hit goal exactly in <span id="reqYears">18</span> years
          </div>
          <div class="option-card accelerated" onclick="applyScenario('accelerated')">
            <strong>Accelerated</strong><br>
            Invest <span id="accSIP">₹65,000</span>/month<br>
            Reach in <span id="accYears">13</span> years
          </div>
          <div class="option-card dream" onclick="applyScenario('dream')">
            <strong>Dream Mode</strong> ★<br>
            <label class="toggle-switch">
              <input type="checkbox" id="stepUpToggle">
              <span class="toggle-slider"></span>
            </label> 10% annual increase<br>
            Reach in <span id="dreamYears">11</span> years
          </div>
        </div>

        <div class="slider-container" style="margin-top:24px">
          <label>Increase monthly SIP by <strong>₹<span id="boostAmount">10,000</span></strong></label>
          <input type="range" min="0" max="50000" value="10000" step="5000" id="boostSlider">
          <div style="font-size:20px;margin-top:12px;text-align:center;color:var(--accent)">
            You’ll reach your goal in <strong id="boostYears">15</strong> years instead!
          </div>
        </div>

        <div class="slider-container" style="margin-top:16px">
          <label>Add one-time lump sum of <strong>₹<span id="lumpAmount">15</span> Lakh</strong> today</label>
          <input type="range" min="0" max="100" value="15" id="lumpSlider">
          <div style="font-size:20px;margin-top:12px;text-align:center;color:var(--success)">
            Required SIP drops to <strong id="lumpSIP">₹28,000</strong>/month
          </div>
        </div>

        <div style="margin-top:20px;padding:20px;background:#fffbeb;border-radius:16px;text-align:center">
          <strong>Bull Market Upside:</strong> With 18/24/30% returns → Your ₹1 Cr becomes <strong id="bullCorpus">₹2.8 Cr</strong>
        </div>
      </div>
    </div>

    <!-- Rest of HTML unchanged -->
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const $ = id => document.getElementById(id);
  const fmt = n => n >= 1e7 ? "₹" + (n/1e7).toFixed(1) + " Cr" : n >= 1e5 ? "₹" + (n/1e5).toFixed(1) + " L" : "₹" + n.toLocaleString('en-IN');

  const fvSIP = (m, r, y) => {
    if (!m) return 0;
    const i = r/100/12, n = y*12;
    return i === 0 ? m*n : m * ((Math.pow(1+i,n)-1)/i) * (1+i);
  };

  const reqSIP = (fv, r, y) => {
    const i = r/100/12, n = y*12;
    return i === 0 ? fv/n : fv * i / ((Math.pow(1+i,n)-1)*(1+i));
  };

  const fvLump = (p, r, y) => p * Math.pow(1 + r/100, y);

  let lastState = null;

  // Excel Download — NOW FULLY WORKING
  $('downloadBtn').onclick = () => {
    if (!lastState) return alert("Please calculate your plan first!");
    const wb = XLSX.utils.book_new();
    const data = [
      ["Simple SIP Planner - Your Wealth Plan"],
      [""],
      ["Total Monthly Income", fmt(lastState.income)],
      ["Total Expenses", fmt(lastState.expense)],
      ["Monthly SIP", fmt(lastState.sipAmount)],
      ["Time Horizon", lastState.y + " years"],
      ["Expected Corpus", fmt(lastState.baseFV)],
      ["Bull Market Upside", fmt(lastState.bullFV)],
      ["Wealth Created", fmt(lastState.baseFV - lastState.sipAmount*12*lastState.y)],
      [""],
      ["Golden Rule: Start today. Every year delay costs crores."]
    ];
    const ws = XLSX.utils.aoa_to_sheet(data);
    XLSX.utils.book_append_sheet(wb, ws, "SIP Plan");
    XLSX.writeFile(wb, "My_SIP_Plan_" + new Date().toISOString().slice(0,10) + ".xlsx");
    confetti({particleCount: 100, spread: 70, origin: { y: 0.6 }});
  };

  // Goal Planner Logic
  $('calcGoal').onclick = () => {
    const target = +$('target').value || 1e8;
    const years = +$('goalYears').value || 18;
    const cagr = +$('goalCagr').value || 14;
    const income = +$('goalIncome').value || 120000;

    const requiredSIP = Math.round(reqSIP(target, cagr, years));
    const safeSIP = Math.round(income * 0.2);
    const accSIP = Math.round(requiredSIP * 1.35);

    lastState = {target, years, cagr, requiredSIP};

    $('goalResult').innerHTML = `
      <div style="text-align:center;padding:20px">
        <div class="muted">Required Monthly SIP</div>
        <div class="big" style="font-size:56px">${fmt(requiredSIP)}</div>
        <div style="margin:20px 0">to reach <strong>${fmt(target)}</strong> in ${years} years</div>
      </div>`;
    $('goalResult').style.display = 'block';
    $('goalScenarios').style.display = 'block';

    // Update all scenarios
    const updateScenarios = () => {
      const boost = +$('boostSlider').value;
      const lump = +$('lumpSlider').value * 100000;
      const stepUp = $('stepUpToggle').checked;

      const effectiveSIP = requiredSIP + boost;
      const newYears = Math.ceil(findYears(effectiveSIP, cagr, target));
      const lumpFV = fvLump(lump, cagr, years);
      const newReqSIP = Math.round(reqSIP(target - lumpFV, cagr, years));

      $('safeSIP').textContent = fmt(safeSIP);
      $('reqSIP').textContent = fmt(requiredSIP);
      $('accSIP').textContent = fmt(accSIP);
      $('boostAmount').textContent = boost.toLocaleString();
      $('lumpAmount').textContent = (lump/100000).toFixed(0);
      $('lumpSIP').textContent = fmt(newReqSIP);
      $('boostYears').textContent = newYears;
      $('bullCorpus').textContent = fmt(fvSIP(requiredSIP, cagr+8, years));
    };

    const findYears = (sip, rate, goal) => {
      let total = 0, y = 0;
      while (total < goal && y < 50) {
        total = fvSIP(sip * Math.pow(1.1, y), rate, y+1);
        y++;
      }
      return y;
    };

    $('boostSlider').oninput = updateScenarios;
    $('lumpSlider').oninput = updateScenarios;
    $('stepUpToggle').onchange = updateScenarios;

    updateScenarios();
  };

  window.applyScenario = (type) => {
    // Future: apply to main planner
    alert("This will apply to your main plan soon! Stay tuned.");
  };

  // Tab switching
  $('tabPlanner').onclick = () => { $('panePlanner').style.display = 'block'; $('paneGoal').style.display = 'none'; $('tabPlanner').classList.add('primary'); $('tabGoal').classList.remove('primary'); };
  $('tabGoal').onclick = () => { $('panePlanner').style.display = 'none'; $('paneGoal').style.display = 'block'; $('tabGoal').classList.add('primary'); $('tabPlanner').classList.remove('primary'); };

  // Initial load
  setTimeout(() => $('calc').click(), 500);
});
</script>
</body>
</html>
