<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Simple SIP Planner — Your Wealth, Your Future</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
<style>
  :root{--bg:#f8fffe;--card:#ffffff;--accent:#0d9488;--accent2:#0f766e;--text:#1e293b;--muted:#64748b;--success:#16a34a;--danger:#dc2626;--shadow:0 10px 30px rgba(0,0,0,0.08);--bull:#f59e0b}
  *{box-sizing:border-box}
  body{font-family:Inter,system-ui,Arial,sans-serif;background:var(--bg);margin:0;padding:20px 16px;color:var(--text);line-height:1.6;background:linear-gradient(135deg,#f0fdfa 0%,#ccfbf1 100%)}
  .wrap{max-width:1100px;margin:0 auto}
  .header{display:flex;flex-wrap:wrap;gap:16px;justify-content:space-between;align-items:center;margin-bottom:24px}
  h1{font-size:28px;margin:0;font-weight:900;color:var(--accent2)}
  .card{background:var(--card);border-radius:20px;padding:28px;box-shadow:var(--shadow);border:1px solid #ccfbf1}
  .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:20px}
  input[type=number],select{width:100%;padding:14px;border-radius:12px;border:1px solid #94a3b8;font-size:16px}
  .btn{padding:14px 28px;border-radius:12px;border:none;cursor:pointer;font-weight:700;font-size:16px;transition:all .3s}
  .btn.primary{background:var(--accent);color:#fff}
  .btn.ghost{background:transparent;border:2px solid #94a3b8;color:var(--text)}
  .panel{background:#f0fdfa;border-radius:16px;padding:24px;border:1px solid #ccfbf1;margin-top:24px;position:relative;overflow:hidden}
  .panel::before{content:"";position:absolute;top:0;left:0;width:6px;height:100%;background:var(--accent)}
  .kpi{font-size:32px;font-weight:900;color:var(--accent2)}
  .big{font-size:44px;font-weight:900;color:var(--accent)}
  .muted{color:var(--muted);font-size:14px}
  .segmented{display:inline-flex;border-radius:14px;overflow:hidden;border:1px solid #94a3b8}
  .segmented button{background:#fff;padding:12px 20px;cursor:pointer;font-weight:700;font-size:15px;color:var(--text)}
  .segmented button.active{background:var(--accent);color:#fff}
  .whatsapp{position:fixed;right:20px;bottom:20px;background:#25D366;color:#fff;padding:18px 24px;border-radius:60px;display:flex;gap:12px;align-items:center;box-shadow:0 12px 30px rgba(37,211,102,0.4);text-decoration:none;font-weight:700;z-index:999;font-size:17px;animation:pulse 2s infinite}
  @keyframes pulse{0%{box-shadow:0 12px 30px rgba(37,211,102,0.4)}50%{box-shadow:0 12px 40px rgba(37,211,102,0.6)}100%{box-shadow:0 12px 30px rgba(37,211,102,0.4)}}
  .summary-bar{background:#0f766e;color:#fff;padding:20px;border-radius:16px;margin:24px 0;display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:20px;text-align:center}
  .highlight{background:#fffbeb;border:1px solid #fde68a;padding:20px;border-radius:16px;margin:20px 0;text-align:center}
  .slider-container{margin:32px 0;background:#f8fffe;padding:24px;border-radius:16px;border:1px solid #ccfbf1}
  .chart-panel{background:#fff;border-radius:16px;padding:24px;box-shadow:var(--shadow);margin-top:24px}
  .age-insight{background:#f0fdf4;padding:24px;border-radius:16px;margin:20px 0;border:1px solid #86efac;font-size:18px;font-weight:600;text-align:center}
  .fd-comparison{background:#fef2f2;padding:20px;border-radius:16px;margin:20px 0;border-left:6px solid #dc2626}
  .disclaimer{background:#f0fdfa;padding:16px;border-radius:12px;margin:20px 0;border:1px solid #99f6e4;font-size:14px;text-align:center}
</style>
</head>
<body>

<a class="whatsapp" href="https://wa.me/917666123827?text=Hi!%20I%20just%20used%20your%20SIP%20Planner.%20I%20can%20invest%20around%20₹50,000/month.%20Please%20help%20me%20start." target="_blank" rel="noopener">Talk on WhatsApp</a>

<div class="wrap">
  <div class="header">
    <div>
      <h1>Simple SIP Planner</h1>
      <div class="sub">Your path to financial freedom starts here</div>
    </div>
    <div style="display:flex;gap:12px;flex-wrap:wrap;align-items:center">
      <button id="downloadBtn" class="btn primary">Download Your Plan (Excel)</button>
      <button id="resetBtn" class="btn ghost">Reset</button>
    </div>
  </div>

  <div class="disclaimer">
    Conservative returns: Large 10%, Mid 14%, Small 18% — lower end of history.<br>
    In strong bull markets (2003–07, 2020–24): Large ~14%, Mid ~22%, Small ~30%.
  </div>

  <div class="card">
    <div style="display:flex;gap:12px;margin-bottom:20px">
      <button id="tabPlanner" class="btn primary">Planner</button>
      <button id="tabGoal" class="btn ghost">Goal Planner</button>
    </div>

    <!-- PLANNER TAB -->
    <div id="panePlanner">
      <div class="radio-group">
        <label><input type="radio" name="userType" value="single" checked> Single</label>
        <label><input type="radio" name="userType" value="couple"> Couple</label>
      </div>

      <div id="singleInputs">
        <div class="grid">
          <div><label>Your Age</label><input id="ageSingle" type="number" value="30" min="20" max="70"></div>
          <div><label>Monthly Income (₹)</label><input id="incomeSingle" type="number" value="120000"></div>
        </div>
      </div>

      <div id="coupleInputs" style="display:none">
        <div class="grid">
          <div><label>Husband Age</label><input id="ageHusband" type="number" value="30"></div>
          <div><label>Wife Age</label><input id="ageWife" type="number" value="30"></div>
          <div><label>Husband Income</label><input id="husband" type="number" value="60000"></div>
          <div><label>Wife Income</label><input id="wife" type="number" value="60000"></div>
        </div>
      </div>

      <div class="grid">
        <div><label>Household Expenses (₹)</label><input id="house" type="number" value="20000"></div>
        <div><label>EMI (₹)</label><input id="emi" type="number" value="0"></div>
        <div><label>Misc Expenses (₹)</label><input id="misc" type="number" value="0"></div>
      </div>

      <hr style="margin:32px 0;border-top:1px dashed #94a3b8">

      <div style="display:flex;flex-wrap:wrap;gap:24px;justify-content:space-between;align-items:end">
        <div>
          <div style="font-weight:700;margin-bottom:10px">Risk Profile</div>
          <div class="segmented">
            <button id="presetConservative" class="seg-btn">Conservative</button>
            <button id="presetBalanced" class="seg-btn active">Balanced</button>
            <button id="presetAggressive" class="seg-btn">Aggressive</button>
          </div>
        </div>

        <div>
          <div style="font-weight:600;margin-bottom:12px">Allocation</div>
          <div style="display:flex;gap:12px;flex-wrap:wrap">
            <div><input id="lc" type="number" value="40" min="0" max="100" style="width:100px"> Large %</div>
            <div><input id="mc" type="number" value="30" min="0" max="100" style="width:100px"> Mid %</div>
            <div><input id="sc" type="number" value="30" min="0" max="100" style="width:100px"> Small %</div>
          </div>
          <div style="font-weight:600;margin:20px 0 8px">Expected CAGR (%)</div>
          <div style="display:flex;gap:12px;flex-wrap:wrap">
            <div><input id="lc_r" type="number" value="10" step="0.5" style="width:100px"></div>
            <div><input id="mc_r" type="number" value="14" step="0.5" style="width:100px"></div>
            <div><input id="sc_r" type="number" value="18" step="0.5" style="width:100px"></div>
          </div>
        </div>
      </div>

      <div style="margin-top:24px">
        <label>Time Horizon</label>
        <select id="years">
          <option value="15" selected>15 years</option>
          <option value="3">3 years</option><option value="6">6 years</option><option value="9">9 years</option>
          <option value="12">12 years</option><option value="18">18 years</option><option value="21">21 years</option>
          <option value="24">24 years</option><option value="27">27 years</option><option value="30">30 years</option>
        </select>
      </div>

      <div style="margin:24px 0;padding:20px;background:#f0f9ff;border-radius:16px">
        <label style="font-weight:600"><input type="radio" name="sipMode" value="auto" id="sipMode_auto" checked> Auto-calculate SIP from surplus</label><br><br>
        <label style="font-weight:600"><input type="radio" name="sipMode" value="manual" id="sipMode_manual"> Manual SIP: ₹<input id="manualSIP" type="number" value="25000" style="width:140px;padding:8px"> /month</label>
      </div>

      <div style="text-align:center;margin:40px 0">
        <button id="calc" class="btn primary" style="padding:18px 50px;font-size:21px">Calculate My Future</button>
      </div>

      <div id="summaryBar" class="summary-bar" style="display:none">
        <div><div class="muted">Income</div><div class="kpi" id="totalIncome"></div></div>
        <div><div class="muted">Expenses</div><div class="kpi" id="totalExpense"></div></div>
        <div><div class="muted">Your SIP</div><div class="kpi" id="monthlySIP"></div></div>
      </div>

      <div id="moneyStory" class="panel" style="display:none"></div>
      <div id="retirementInsight" class="age-insight" style="display:none"></div>
      <div id="fdComparison" class="fd-comparison" style="display:none"></div>

      <div id="extraSIP" class="slider-container" style="display:none">
        <label style="font-size:19px;font-weight:700">What if you add just ₹5,000 more per month?</label>
        <input type="range" min="0" max="50000" value="5000" step="1000" id="extraSlider">
        <div style="font-size:24px;margin-top:20px;text-align:center">
          Extra ₹<span id="extraAmount">5,000</span>/month → <strong id="newCorpus"></strong>
          <span style="color:#16a34a"> (+<span id="gainAmount"></span>)</span>
        </div>
        <div style="margin-top:20px;padding:20px;background:#ecfdf5;border-radius:12px;font-size:16px;line-height:1.6;font-weight:500">
          <strong>Think about this:</strong> You're <span id="userAge"></span> today. In <span id="yearsLeft"></span> years, you'll be <span id="futureAge"></span>.
          With your current plan, you'll have <strong id="baseCorpusText"></strong>. But by increasing just <strong>₹5,000/month</strong>, you could reach <strong id="boostedCorpusText"></strong> — 
          that's <strong id="extraWealthText"></strong> extra wealth from a small habit change. The power of compounding rewards consistency.
        </div>
      </div>

      <div class="panel">
        <h3>Compare Risk Profiles</h3>
        <div id="compareCards" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:16px"></div>
      </div>

      <div class="chart-panel">
        <h3>Your Wealth Growth Over Time</h3>
        <canvas id="growthChart"></canvas>
      </div>
    </div>

    <!-- GOAL PLANNER TAB — FULLY RESTORED -->
    <div id="paneGoal" style="display:none">
      <h2 style="text-align:center;margin-bottom:24px">Goal-Based SIP Calculator</h2>
      <div class="grid">
        <div><label>Target Amount (₹)</label><input id="target" type="number" value="100000000"></div>
        <div><label>Years to Achieve</label><input id="goalYears" type="number" value="18"></div>
        <div><label>Expected CAGR (%)</label><input id="goalCagr" type="number" value="15" step="0.5"></div>
      </div>

      <div style="margin:24px 0">
        <label>Your Monthly Household Income (₹)</label>
        <input id="goalIncome" type="number" value="120000" style="padding:14px;font-size:16px">
      </div>

      <div style="margin:32px 0;text-align:center">
        <button id="calcGoal" class="btn primary" style="padding:16px 40px;font-size:19px">Calculate Required SIP</button>
      </div>

      <div id="goalResult" class="panel" style="display:none;text-align:center;font-size:20px"></div>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const $ = id => document.getElementById(id);

  const fmt = n => {
    if (isNaN(n)) return "₹0";
    const abs = Math.abs(n);
    if (abs >= 1e7) return "₹" + (n/1e7).toFixed(1) + " Cr";
    if (abs >= 1e5) return "₹" + (n/1e5).toFixed(1) + " L";
    return "₹" + n.toLocaleString('en-IN');
  };

  const fvSIP = (m, r, y) => {
    if (!m || !y) return 0;
    const i = r/100/12, n = y*12;
    if (i === 0) return m * n;
    return m * ((Math.pow(1+i, n) - 1) / i) * (1 + i);
  };

  let growthChart = null;
  let userIncome = localStorage.getItem('sip_income') ? +localStorage.getItem('sip_income') : null;

  const getState = () => {
    const income = $('singleInputs').style.display !== 'none' 
      ? +$('incomeSingle').value 
      : (+$('husband').value || 0) + (+$('wife').value || 0);
    userIncome = income;
    localStorage.setItem('sip_income', income);

    const expense = (+$('house').value || 0) + (+$('emi').value || 0) + (+$('misc').value || 0);
    const autoSIP = Math.max(0, income - expense);
    const manualSIP = +$('manualSIP').value || 0;
    const sipAmount = $('sipMode_auto').checked ? autoSIP : manualSIP;
    const y = +$('years').value;
    const age = $('singleInputs').style.display !== 'none' ? +$('ageSingle').value : Math.max(+$('ageHusband').value, +$('ageWife').value);

    const rates = {lc: +$('lc_r').value || 10, mc: +$('mc_r').value || 14, sc: +$('sc_r').value || 18};
    const alloc = {lc: +$('lc').value || 40, mc: +$('mc').value || 30, sc: +$('sc').value || 30};

    const baseFV = fvSIP(sipAmount * alloc.lc/100, rates.lc, y) +
                   fvSIP(sipAmount * alloc.mc/100, rates.mc, y) +
                   fvSIP(sipAmount * alloc.sc/100, rates.sc, y);

    const bullFV = fvSIP(sipAmount * alloc.lc/100, 14, y) +
                   fvSIP(sipAmount * alloc.mc/100, 22, y) +
                   fvSIP(sipAmount * alloc.sc/100, 30, y);

    const fdFV = fvSIP(sipAmount, 5, y);

    return {income, expense, sipAmount, y, rates, alloc, baseFV, bullFV, fdFV, age};
  };

  const renderAll = () => {
    if ((+$('lc').value + +$('mc').value + +$('sc').value) !== 100) return;
    const s = getState();

    $('totalIncome').textContent = fmt(s.income);
    $('totalExpense').textContent = fmt(s.expense);
    $('monthlySIP').textContent = fmt(s.sipAmount);
    $('summaryBar').style.display = 'grid';

    const invested = s.sipAmount * 12 * s.y;
    $('moneyStory').innerHTML = `
      <div style="text-align:center;padding:20px">
        <div class="muted">Total Invested</div>
        <div class="kpi">${fmt(invested)}</div>
        <div style="font-size:60px;color:var(--accent)">→</div>
        <div class="big">${fmt(s.baseFV)}</div>
        <div style="font-size:20px;margin-top:12px;color:#f59e0b">Bull Market → ${fmt(s.bullFV)}</div>
      </div>
    `;
    $('moneyStory').style.display = 'block';

    $('userAge').textContent = s.age;
    $('yearsLeft').textContent = s.y;
    $('futureAge').textContent = s.age + s.y;
    $('baseCorpusText').textContent = fmt(s.baseFV);
    $('boostedCorpusText').textContent = fmt(s.baseFV * 1.6); // approx boost
    $('extraWealthText').textContent = fmt(s.baseFV * 0.6);

    const extra = +$('extraSlider').value || 5000;
    const newSIP = s.sipAmount + extra;
    const newFV = fvSIP(newSIP * s.alloc.lc/100, s.rates.lc, s.y) +
            fvSIP(newSIP * s.alloc.mc/100, s.rates.mc, s.y) +
            fvSIP(newSIP * s.alloc.sc/100, s.rates.sc, s.y);
    $('extraAmount').textContent = extra.toLocaleString('en-IN');
    $('newCorpus').textContent = fmt(newSIPFV);
    $('gainAmount').textContent = fmt(newSIPFV - s.baseFV);

    $('retirementInsight').innerHTML = `At age <strong>${s.age + s.y}</strong>, your corpus could be <strong>${fmt(s.baseFV)}</strong><br>
      In bull market: <strong>${fmt(s.bullFV)}</strong> → <strong>${fmt(s.bullFV * 0.04 / 12)}/month</strong> passive income for life.`;
    $('retirementInsight').style.display = 'block';

    $('fdComparison').innerHTML = `Same money in FD @5% → ${fmt(s.fdFV)}<br>
      You’d leave <strong style="color:#dc2626">${fmt(s.baseFV - s.fdFV)}</strong> on the table.`;
    $('fdComparison').style.display = 'block';

    // Compare Cards
    const profiles = [
      {name:"Conservative", lc:50, mc:30, sc:20},
      {name:"Balanced", lc:40, mc:30, sc:30},
      {name:"Aggressive", lc:25, mc:35, sc:40}
    ];
    let cards = '';
    profiles.forEach(p => {
      const base = fvSIP(s.sipAmount * p.lc/100, s.rates.lc, s.y) +
                   fvSIP(s.sipAmount * p.mc/100, s.rates.mc, s.y) +
                   fvSIP(s.sipAmount * p.sc/100, s.rates.sc, s.y);
      const bull = fvSIP(s.sipAmount * p.lc/100, 14, s.y) +
                   fvSIP(s.sipAmount * p.mc/100, 22, s.y) +
                   fvSIP(s.sipAmount * p.sc/100, 30, s.y);
      const active = p.lc === s.alloc.lc && p.mc === s.alloc.mc && p.sc === s.alloc.sc;
      cards += `<div class="panel" style="border:${active?'4px solid #0d9488':'1px solid #e2e8f0'}">
        <strong>${p.name}</strong> • L:${p.lc} M:${p.mc} S:${p.sc}<br>
        <div class="kpi">${fmt(base)}</div>
        <small>Bull → ${fmt(bull)}</small>
      </div>`;
    });
    $('compareCards').innerHTML = cards;

    // Chart
    if (growthChart) growthChart.destroy();
    const labels = Array.from({length: s.y + 1}, (_, i) => i === 0 ? 'Now' : `Year ${i}`);
    const baseData = labels.map((_, i) => fvSIP(s.sipAmount * s.alloc.lc/100, s.rates.lc, i) + fvSIP(s.sipAmount * s.alloc.mc/100, s.rates.mc, i) + fvSIP(s.sipAmount * s.alloc.sc/100, s.rates.sc, i));
    const bullData = labels.map((_, i) => fvSIP(s.sipAmount * s.alloc.lc/100, 14, i) + fvSIP(s.sipAmount * s.alloc.mc/100, 22, i) + fvSIP(s.sipAmount * s.alloc.sc/100, 30, i));

    growthChart = new Chart($('growthChart'), {
      type: 'line',
      data: {labels, datasets: [
        {label: 'Your Plan', data: baseData, borderColor: '#0d9488', backgroundColor: 'rgba(13,148,136,0.1)', fill: true, tension: 0.4},
        {label: 'Bull Market (14/22/30%)', data: bullData, borderColor: '#f59e0b', borderDash: [8,4], fill: false, tension: 0.4}
      ]},
      options: {plugins: {tooltip: {callbacks: {label: ctx => fmt(ctx.raw)}}}, scales: {y: {ticks: {callback: fmt}}}}
    });

    ['extraSIP'].forEach(id => $(id).style.display = 'block');
    if (s.baseFV > 5e7 && !window.done) { confetti({particleCount: 120, spread: 70, origin: {y: 0.6}}); window.done = true; }
  };

  // Presets
  const presets = {
    conservative: {lc:50,mc:30,sc:20},
    balanced: {lc:40,mc:30,sc:30},
    aggressive: {lc:25,mc:35,sc:40}
  };

  Object.keys(presets).forEach(key => {
    $(`preset${key.charAt(0).toUpperCase() + key.slice(1)}`).addEventListener('click', () => {
      const p = presets[key];
      $('lc').value = p.lc; $('mc').value = p.mc; $('sc').value = p.sc;
      document.querySelectorAll('.seg-btn').forEach(b => b.classList.remove('active'));
      event.target.classList.add('active');
      renderAll();
    });
  });

  // Tabs
  $('tabPlanner').onclick = () => {
    $('panePlanner').style.display = 'block';
    $('paneGoal').style.display = 'none';
    $('tabPlanner').className = 'btn primary';
    $('tabGoal').className = 'btn ghost';
  };
  $('tabGoal').onclick = () => {
    $('panePlanner').style.display = 'none';
    $('paneGoal').style.display = 'block';
    $('tabPlanner').className = 'btn ghost';
    $('tabGoal').className = 'btn primary';
  };

  // Goal Calculator
  $('calcGoal').onclick = () => {
    const target = +$('target').value;
    const years = +$('goalYears').value;
    const cagr = +$('goalCagr').value || 15;
    const i = cagr/100/12, n = years*12;
    const sip = Math.round(target * i / ((Math.pow(1+i,n)-1)*(1+i)));
    $('goalResult').innerHTML = `
      <div style="padding:30px;background:#ecfdf5;border-radius:16px">
        <div style="font-size:18px;color:#065f46">Required Monthly SIP</div>
        <div style="font-size:48px;font-weight:900;color:#0d9488;margin:12px 0">${fmt(sip)}</div>
        <div>to reach <strong>${fmt(target)}</strong> in ${years} years @ ${cagr}% CAGR</div>
      </div>
    `;
    $('goalResult').style.display = 'block';
  };

  // Events
  $('calc').onclick = renderAll;
  $('extraSlider').oninput = renderAll;
  $('downloadBtn').onclick = () => {
    const s = getState();
    const wb = XLSX.utils.book_new();
    const data = [
      ["SIP Planner Results"], [""],
      ["Income", fmt(s.income)], ["SIP", fmt(s.sipAmount)], ["Years", s.y],
      ["Final Corpus", fmt(s.baseFV)], ["Bull Market", fmt(s.bullFV)]
    ];
    XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(data), "Plan");
    XLSX.writeFile(wb, "My_SIP_Plan.xlsx");
  };
  $('resetBtn').onclick = () => location.reload();

  document.querySelectorAll('input[name="userType"]').forEach(r => r.onchange = () => {
    $('singleInputs').style.display = r.value === 'couple' ? 'none' : 'block';
    $('coupleInputs').style.display = r.value === 'couple' ? 'block' : 'none';
  });

  setTimeout(renderAll, 500);
});
</script>
</body>
</html>
